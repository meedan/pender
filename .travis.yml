language: minimal
before_install:
-  openssl aes-256-cbc -K $encrypted_3491736328a2_key -iv $encrypted_3491736328a2_iv -in config/config.yml.enc -out ./config.yml -d
- cp config/database.yml.example config/database.yml
- cp config/sidekiq.yml.example config/sidekiq.yml
- echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
- docker-compose build
- docker-compose -f docker-compose.yml -f docker-test.yml up -d pender
- wget -q --waitretry=5 --retry-connrefused -t 20 -T 10 -O - http://localhost:3200
before_script:
- docker-compose exec pender test/setup-parallel
script:
- docker-compose exec pender bundle exec rake "parallel:test[3]"
- docker-compose exec pender bundle exec rake parallel:spec
after_script:
- docker-compose exec pender cat tmp/performance.csv
- docker-compose exec -e TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST -e TRAVIS_TEST_RESULT=$TRAVIS_TEST_RESULT -e TRAVIS_BRANCH=$TRAVIS_BRANCH -e CC_TEST_REPORTER_ID=$CC_TEST_REPORTER_ID -e GIT_COMMIT_SHA=$GIT_COMMIT_SHA -e GIT_COMMITTED_AT=$GIT_COMMITTED_AT pender test/test-coverage
notifications:
  slack:
    secure: jeHPR5g+4VbyOV4kXEb6kxXmlw1cn67/HEBhpL1V/EdxpnmUbj1DyMcYDHcj4D9A2wjuVNYxhmqVUfkNKeSBYiBR+hqZs4WEvRfSE8WIhnrU+A1u+IfZtv1w5jairrBS9B9+lDhSr/EKTP8FactKLDvWNkZgZTYhSmLxarCUHnAUKo3Kp48cXdt8ywtbVXylnBtE0ofyKSu1qAiM+Oh7mJjgEUymeRNy44DbALnTEpv9y7x+IeDkF0T+IoJYnV7Sk2+vdB18ULVzGfSAnjPIvFPehIQ40I2nfebOksDYqqtTZTXi/yA9tRZdsoIelq1RH8QFSglfqoAR5v/Eamqm13cGO8Xu7e66Lowm0+knSHZrokldFdhcpes1gEYVRiV3CiRbZCJhi69DMuHzm3gvaYyNDWe3Gx9zzekGYGXFpwsLjwOvxWcZSUF3kopFXJIMdMpUKS2OJpGCmsWThXuk4zXm4cEHtZBpWRjxALC+45Lh5/c53Pcv6dUxVx/nN984T8SAdsDfxIMywauYZ3N7CKgVVg5GejX48UaLsh68FczxV5R5ISU3eIOilzU7aslq/vn+uTHTnbx5yQXOpCuTZIoS/eC1PF8wIvq6R9HL7GfZZJv3f7zjddlrdMV9zdM8h1objhfd/4InGncH9YVQbczvO1PTf1CBdNIVSNVEDyE=
env:
  global:
  - secure: lAEcFRWQDoLWn14FvLmF++GbP+Z855baFk8lD9xH+L7qJjVGVmDXanCKEeQ1rfcUaADk6FHhYrckeMmMqrbU1nuq2tA+WXM+/G/P6nWEsFlx8wmBrtFwx3lrgDR/bCyceVTRkuV7PfRtpgsLrJfpFOdSAhITrUXfNe84Fml8do4/36lsLmDs3irjXXhSm4J1lISGxGrVG8AsGo1/EycW6S4Pn++4HfJaWRqg5FZn21pubg8Wtu3kw2iZIkJcbMS0Gt5FneuNMHabT2H5+yQmHVGZqCjUhlElQ57dwb5c1Ktvqv35tZrlE2PlsFJiTk+cReSC6w/X62VvT+IkvPHSP44kjzmp0OhkNw2AWPMGaMxCir/pz7iopJEataKwgtSjMArPEBNQptPMUcE4k58h9FDFplSXB5SkraUMO4YzfuahV4Wv5HnG+IJghK/ymu4ejrL2fXRfUBNNo+7RTocG1+3oMorhJhBlmLtk6u3PO2Qjhwmy3JlKFa1qvfuV3zuY8GctQGrKgJbHMuAnzWT4qJ5FzUZ7K4GtI72oUqB5H98V5+YX7gZnrqv8VcGghMJX/cl5lXkeYzRlFZ9aMzYvFfaKHxhx01pUjdaH3xA9fvF3GrdwNSiwv8Ic+Tg69vkXqGdyVNVk6UWj1Rjg59SEiwQpleKG1tude3EMofz6r+s=
  - secure: wU8QPGKKuhThj58tuPPYw4qkY+sqKi/LcoPLyIzHTyIUm4nJVI1hBEqbuoKJjfl5wkG4tI4enxELrKvATqY+EhmVsuTNaD/aBh5V6yuLYXITxmXqhMKTMyic+loUMT4Re8PcADq3FqxXppTPLc/+DLVRXOoxS0i5ki4x8a3fCmL802HbbCLPDuC+AFt73cyy1sPCzKOhZ0UFGdeq6Tj+U+6vCrkeRxvgh81OOxR4E9PKIo8/O46PjYZb4mskojF+GO+IYquigdVNWG2fCFKZsLzUgISXvCvKg6/bk2agRIrl7wpv79vryeOAKPwV/AIjZSbj2zAHsbnUVPDZ5yrGFM52ipKeLTDZ1pr8MOYWK8CLXleqSN2yfVCJnG3julTD3MbhuYhhUFtjk+zPRpI1EEusS2IjduOpYeRPWNmKoQRQbCvuQaCowbIyZosHK34rqf8GaFdNdl66PB9N7ST3YMP6mbxSBzO/9pWpJDOtoYEGUd6KnAMFiOapSF7WV0p2Pol7qCeJRvT9vpnRzQlLoHTA8nczNWscRyILwEfCao9CSLVW9BunDadqhiHKNm9d/bgcCB/sPeJNdftnHVMM+JNtY+SnZwE9joJgdBvnFV7w1DHsPrfWSq0G73HCmwBUWapGE5EGLrYrvAyoxlr/fMGOwBIDWXxqXYJRJvozl6w=
  - secure: 1JjD5z51jUV2houymNbIktmEUJBL7Unh2z6De3RFQqapcrI9fsujRKPLxSvVRTSOe8hc9/7EjdEXPs2fKgrqYUntNVUYdJm+zkvAcgNow4SlChLSX3f0o/muaRS4myqe4OTOEUuDMn3yOSWnCejzOw/T4+i/w2q75WV922JaryRJrkIFojk2qFpcR7KBkbfoiDlld31pG1ChCHCgXFpvSQFsQ4WwfgAsojLzqTw9H6vQ8HRON4LkL+8To/lfRSQoXWcM16yo9PMY0nUCf+D/GyD6czmF5/oOwRZQUCGH4ThkEcwfE52GuzdmStdXPxA4/1AOMGJXlEqH3kud3BH9XnhWzb9PkzucqSJFy8PSJByDphvzUkH4NcAgTGLyxsbxroKDtF2F3cFZ7B8Epl4fRY8fBlr2wUHWbhgiTqcOTrOIjF1m/PEcWP1HnGrXweQA45gQ8AaUN/nviV6M6OVnDFBg2sM/KpX+a4Zt14Txr8J9JsNPYv6zd7LQITnLnN8j03g45fQx6pYtwz1eBycspBfh/OG0TRHj1K2v6+GVjLaNpxoD+r5y6ysMg3PuFIAOxDiEHP9KnaVqlAXcQu+qGWxhOHmfzZH7cJ9gVOSrgsGTrfSpkVU/vgIBYsb/gKWE1gUVLF4yJqosLE0AvHVHUJFNBYNLpAkMTIQKpVhSHCM=
  - secure: EIzOqVwOQkqhE9rzEX2xyWWpXLEF0zkCqkAhRC4S2J1UCawIkwN26XXQOZj6VBNhovW1WQSg8DueW9XV1DONCPAi4enEB5oEsgMOojANEiEAZJPaIFB6ewTLgRe+/obt08xc0Urm4szWLKt4Gljhf0sh3ofCnrnKci1XWpMc4p0QvMGruZlP6bbn36Z/jqxxIwMz+IcYcZblR1sPVWsp0KsRgMAIx00VyzJlTy3s6tkWZwW1SQrLijkP29/wbvXWltfqETblcUCIak1hfJj10ggFxDOIfeKClNFImpGRq4VJT5LacCiSZrQxlhD+47UCxXZ+MQYU/97tggJPl7jsqMVRzpwfuajy4Oh7kgUugDKKoVhCKDKiw0o+X9WerNG6H2PlpKCwuxpAqL51bl6JOtEkMajOGl/hyMCogpqT+6hNNJoh4CcpHHogFcipl/BW8DqKMB9ZWU9Cya54Vx+UBwkuXzo8Pd+q0kXquxzrGTpbHJh8T9haLrT8h0/xTH9zeR+z4w5xgC8EKx2brRpLpyp3Of5dUjZFVcf8hAjwD8UG/wSRuWjzzW5g5uCrfND5xxSTiU1N7lREJOE70qOfrHLQMupYDBBTdQeG/CvusyhqQj5nQQta3q2GCO7cPOY5h2FMVVbEE2oDJUOB4af+cIIO9bBu2gNjSerivlP15T0=
  - secure: L8WAdToOxxnsXnJcuNFiQ3HTdYrxULp4X3rOLb1Mra/6/hFX1IIN37xC/PNbsvYFyd1PDgkxY+34SY+eJuXznaPTe5LvHCMM1MyA1qwnEAeOx4AWdXz/t3yXpQOAz/cZf3qsUuK9vH7P+8iNX/XF0K0S1W/gUBWwrG5dksMSHAZUXJWf1SUe1DCYlul/wIRBWxy6uql41dznLSVnGQCHAb+aq1burMFf5CyW6EKGk3BN6u1RmPIhJIVpgXyI/wJzueqwo6u4KNwb44zeCFfJ1Z3rIZQFCGwt5KRaGslnDIPTKVgcNwr+yFU0CNf+PAo4UJvuuGbWS7Foifab5g95Rth2BWkJPfh2Etm+U9ZIaRA3JR1aCgCw68uLP2pbn124b1HUHnTCpFdxeeFC2QSesLTdHSg02nHy2zEycJsmdZQ0yCHuRnDywypU2TQlNzsq7i+5uUaH/tdPMWSusp6/0+AljsmgBiFggd0f5tf58xZjF416h8hNjWRxaX+LZRN9i6M1It+nqwS0M1Ty3PPl5ABXn3YIZUtEt2xNsgoi2JnLEUUV9bMn0nc+mEtx+VtpobdGzDdDQazbKuBpxrym3bhdToKrQ9bGfKQxXgTIptzTWTWYC137pxsMQNfNbIRozhLq+9JMpKw/fTV/qkqMQSt8KUaVyot9vlTSDIT1ntU=
  - secure: ukBDbO2iSpAKIku5ETL2aRFhCsJFKrF/k7G73bwKV9OUhFc++QBH602UUEprRdR9OWOwGYmvVIv1nItPw9ar0R3VCWKpnpsyuHEPvVq8U0rfzSDWZWhWa+48MNcKaQPFucShANlWLOJGB2vcCSdyfkNay+HsDvSojeLYaKQjT8Vyf0n13/YMcrfXGiTukGp8twK5neq08Qcrt0q1QjLiYTAQ1K0/iNW0QhlKgNiBlNqPCPRALCDfNJsxbKRy+lZegAujlwAaLqCe3Ph/m1gQFWx3lo2fSOKqZkTE76UhbvmI/TKqnBuI/wwInK3crdR6fBDzhoTW4g65X70w3A3RETjmgOB6LBP4IymN8sQtVHumd/Z8aau8c0WJwdzHx0iND6cm3DIRT+VvtHWEWyyyCTlFWMPhNJ1BPj8A0ZIc5DzpSI2DfEpCh4rdtVn1TN+8GQJZLAx//cG8kJsxyFdqmDBOut2cXtId09Bh+xas2GUSriPW8qxWB2LaHrHqmODy/OqrgRZwCc5KWv01spLoSF7WOV/uy0lsdNfDm2vU+vToTcJavmKRuBluv8Ki2CiRfpyXIrVAZ3J97VYtia1UVwOf/SAwKHhLtakk2wlyJ52OSGgyHBUnKXWdHvcsDWEz3owzMhZ+h7VTSH6g27KMRqVx+mGOfsrVxZ4PlsHXzPY=
